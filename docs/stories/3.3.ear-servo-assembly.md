# Story 3.3: Ear Servo Assembly & Mechanical Integration

## Status
Draft

## Story
**As a** hardware builder,
**I want** 2-DOF articulated ears assembled with servo mechanisms,
**so that** Olaf can express emotions through ear positioning (Doberman-inspired expressiveness).

## Acceptance Criteria

1. **Components Acquired:**
   - 4× Feetech SCS0009 servos (serial bus servos for ear articulation)
   - 1× Bus Servo Controller (STSC series, controls 4 servos via UART)
   - M2/M3 screws for servo mounting
   - Servo horns/brackets (included with servos)
   - Wiring: Servo daisy-chain cables, UART cable to Ears+Neck PCB (Story 3.4)

2. **Left Ear Assembly (2-DOF):**
   - **Horizontal Servo (Base):**
     - Servo 1 mounted in `ear-base-left.stl` bracket
     - Servo controls horizontal ear rotation (forward ↔ back, ±60°)
     - Bracket secured to left side of head housing (M3 screws)
   - **Vertical Servo (Fin):**
     - Servo 2 mounted to Servo 1 horn
     - Servo controls vertical ear orientation (up ↔ down, ±45°)
     - `ear-fin-left.stl` attached to Servo 2 horn (visible ear component)
   - **Range of Motion:**
     - Combined movement allows ear to point forward-up (alert), back-down (relaxed), or any position in between
     - No mechanical binding through full range
     - Smooth movement, no gear stripping

3. **Right Ear Assembly (2-DOF):**
   - Mirror configuration of left ear
   - Servo 3 (horizontal base) + Servo 4 (vertical fin)
   - `ear-base-right.stl` + `ear-fin-right.stl`
   - Range of motion matches left ear (symmetrical)

4. **Servo Controller Wiring:**
   - Bus Servo Controller connected to all 4 servos via daisy-chain serial bus:
     - Servo 1 (left-horizontal) → Servo 2 (left-vertical) → Servo 3 (right-horizontal) → Servo 4 (right-vertical)
   - Power: 5V supply to servo controller (from buck converter or bench supply for testing)
   - Controller UART interface: TX/RX wires prepared (will connect to Ears+Neck PCB in Story 3.4)

5. **Servo Addressing:**
   - Servo 1: ID = 1 (left ear horizontal)
   - Servo 2: ID = 2 (left ear vertical)
   - Servo 3: ID = 3 (right ear horizontal)
   - Servo 4: ID = 4 (right ear vertical)
   - IDs configured via manufacturer software or test script

6. **Mechanical Testing:**
   - Manual test: Send UART commands to controller, verify all 4 servos respond
   - Test ear positions:
     - Alert: Both ears forward, up 30°
     - Relaxed: Both ears back, horizontal
     - Curious (left): Left ear forward-up, right ear horizontal
     - Asymmetric test: Each ear moves independently
   - No mechanical interference with head housing or neck assembly
   - Stable mounting: No wobble or servo slippage

7. **Documentation:**
   - Ear assembly photos: `hardware/wiring/ear-assembly-photos/`
   - Servo ID mapping documented: `firmware/ears_neck/README.md`
   - Mechanical range of motion specifications logged

## Tasks / Subtasks

- [ ] **Task 1: Acquire ear servo components** (AC: 1)
  - [ ] Purchase 4× Feetech SCS0009 servos
  - [ ] Purchase 1× Bus Servo Controller (STSC series, UART interface)
  - [ ] Verify servo horns included with servos
  - [ ] Gather M2/M3 screws for mounting
  - [ ] Prepare daisy-chain servo cables

- [ ] **Task 2: Assemble left ear (2-DOF)** (AC: 2)
  - [ ] Mount Servo 1 in `ear-base-left.stl` bracket (M3 screws)
  - [ ] Secure ear base bracket to left side of head housing
  - [ ] Attach servo horn to Servo 1 output shaft
  - [ ] Mount Servo 2 to Servo 1 horn
  - [ ] Attach `ear-fin-left.stl` to Servo 2 horn
  - [ ] Test range of motion: ±60° horizontal, ±45° vertical
  - [ ] Verify no binding or mechanical interference

- [ ] **Task 3: Assemble right ear (2-DOF)** (AC: 3)
  - [ ] Mount Servo 3 in `ear-base-right.stl` bracket (M3 screws)
  - [ ] Secure ear base bracket to right side of head housing
  - [ ] Attach servo horn to Servo 3 output shaft
  - [ ] Mount Servo 4 to Servo 3 horn
  - [ ] Attach `ear-fin-right.stl` to Servo 4 horn
  - [ ] Test range of motion: ±60° horizontal, ±45° vertical (mirror left ear)
  - [ ] Verify symmetry with left ear

- [ ] **Task 4: Wire servo controller daisy-chain** (AC: 4)
  - [ ] Connect servos in series:
    - [ ] Servo 1 → Servo 2 (left ear chain)
    - [ ] Servo 2 → Servo 3 (bridge to right ear)
    - [ ] Servo 3 → Servo 4 (right ear chain)
  - [ ] Connect servo chain to Bus Servo Controller
  - [ ] Connect 5V power to controller (bench supply or battery for testing)
  - [ ] Prepare UART cable (TX/RX) from controller (will connect to PCB in Story 3.4)

- [ ] **Task 5: Configure servo IDs** (AC: 5)
  - [ ] Connect servo controller to PC (via USB or UART adapter)
  - [ ] Use manufacturer software or serial commands to set IDs:
    - [ ] Servo 1: ID = 1
    - [ ] Servo 2: ID = 2
    - [ ] Servo 3: ID = 3
    - [ ] Servo 4: ID = 4
  - [ ] Verify each servo responds to its ID
  - [ ] Document ID mapping in firmware README

- [ ] **Task 6: Mechanical range testing** (AC: 6)
  - [ ] Send UART position commands to each servo
  - [ ] Test left ear:
    - [ ] Horizontal: -60° to +60°
    - [ ] Vertical: -45° to +45°
    - [ ] Combined movements
  - [ ] Test right ear (mirror left)
  - [ ] Test predefined positions:
    - [ ] Alert: Both ears forward, up 30°
    - [ ] Relaxed: Both ears back, horizontal
    - [ ] Curious: Left forward-up, right horizontal
  - [ ] Verify no wobble, slippage, or binding

- [ ] **Task 7: Documentation** (AC: 7)
  - [ ] Photograph ear assemblies (left and right)
  - [ ] Photograph servo daisy-chain wiring
  - [ ] Save photos to `hardware/wiring/ear-assembly-photos/`
  - [ ] Document in `firmware/ears_neck/README.md`:
    - [ ] Servo ID mapping (1-4)
    - [ ] Range of motion specifications
    - [ ] UART connection to controller

## Dev Notes

### Prerequisites
From Story 3.1 (3D Printing):
- Ear components printed: `ear-base-left/right.stl`, `ear-fin-left/right.stl`
- Head housing available for mounting ear brackets

From Story 3.2 (Head Module PCB):
- Head assembly complete (ears will mount to sides of head)

### Component Specifications

**Feetech SCS0009 Servo:**
- **Type:** Serial bus servo (daisy-chainable)
- **Torque:** 9 kg·cm @ 6V
- **Speed:** 0.14 sec/60° @ 6V
- **Voltage:** 4.8-6V (5V recommended)
- **Communication:** TTL serial (half-duplex UART)
- **Protocol:** Feetech SCS protocol
- **Dimensions:** ~40mm × 20mm × 38mm (L×W×H)
- **Mounting:** M3 screw holes (25mm spacing)

**Bus Servo Controller (STSC Series):**
- **Interface:** UART (TX/RX to ESP32)
- **Power:** Integrated 5V power distribution to servos
- **Channels:** Supports up to 254 servos (daisy-chained)
- **Baud Rate:** 9600, 19200, 38400, 57600, 115200, 1000000 bps (configurable)
- **Control:** Position, speed, torque commands via UART

### Ear Kinematics

**2-DOF Ear Design:**
- **Base Servo (Horizontal):** Rotates ear forward/back relative to head
  - Forward: Alert, attentive, curious
  - Back: Relaxed, neutral, sad
- **Fin Servo (Vertical):** Tilts ear up/down
  - Up: Alert, excited, listening
  - Down: Sad, relaxed, cautious

**Doberman-Inspired Expressiveness:**
- Dogs use ears as primary emotional signal
- Independent ear control = asymmetric expressions (one ear forward, one back)
- Rapid ear movements = excitement, attention shifts
- Combined with eyes and neck = rich multi-modal expression

**Range of Motion:**
| Axis | Servo | Range | Center Position |
|------|-------|-------|-----------------|
| Horizontal (left) | Servo 1 | -60° to +60° | 0° (neutral) |
| Vertical (left) | Servo 2 | -45° to +45° | 0° (level) |
| Horizontal (right) | Servo 3 | -60° to +60° | 0° (neutral) |
| Vertical (right) | Servo 4 | -45° to +45° | 0° (level) |

### Wiring Architecture

**Servo Daisy-Chain (Serial Bus):**
```
Servo 1 → Servo 2 → Servo 3 → Servo 4 → Bus Servo Controller
(left-H)  (left-V)  (right-H)  (right-V)
```

**Controller to ESP32 (Story 3.4):**
- Controller UART1 → ESP32 UART1 (GPIO4 TX, GPIO5 RX)
- This story prepares UART cable; connection happens in Story 3.4

**Power Distribution:**
- 5V power → Bus Servo Controller
- Controller distributes 5V to all 4 servos via daisy-chain
- Peak current: ~2A (all 4 servos active simultaneously)

### Mechanical Assembly Tips

**Servo Horn Alignment:**
- Center servo before attaching horn (send 90° position command)
- Align horn to desired "center" orientation
- Secure horn with included screw
- Test movement before final tightening

**Preventing Gear Stripping:**
- Avoid forcing servo beyond mechanical limits
- Set software limits in firmware (Story 3.5)
- Use torque limiting in servo controller (if available)

**Vibration Dampening:**
- Use rubber washers under servo mounts (reduces vibration transfer)
- Lock-tite on screws (prevents loosening from servo vibration)

### Testing

**Individual Servo Test:**
- Send position command to each servo individually
- Verify servo moves to commanded position
- Check for smooth motion (no stuttering or binding)

**Coordinated Movement Test:**
- Move all 4 servos simultaneously
- Verify no power sag (voltage drop causing servo stalls)
- Check mechanical clearance (ears don't collide with head housing)

**Position Accuracy:**
- Command specific angles (0°, 45°, 90°, -45°)
- Measure actual angle with protractor or digital angle finder
- Calibrate offsets if needed

**Troubleshooting:**
- **Servo not responding:** Check ID configuration, verify daisy-chain wiring
- **Intermittent movement:** Check power supply (voltage sag), verify UART baud rate
- **Binding/resistance:** Check mechanical assembly, reduce range limits
- **Wobble:** Tighten mounting screws, verify servo horn secure

### File Locations

```
hardware/wiring/
└── ear-assembly-photos/            # <-- THIS STORY

firmware/ears_neck/
└── README.md                       # <-- THIS STORY (servo ID mapping)
```

## Dev Agent Record

### Agent Model Used
<!-- To be filled by dev agent -->

### Debug Log References
<!-- To be filled by dev agent -->

### Completion Notes List
<!-- To be filled by dev agent -->

### File List
<!-- To be filled by dev agent -->

## QA Results
<!-- To be filled by QA agent -->

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-08 | v1.0 | Initial story creation from Epic 3 | Sarah (Product Owner) |
