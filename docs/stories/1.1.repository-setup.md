# Story 1.1: Repository Setup & Project Structure

## Status
Ready for Review

## Story

**As a** developer building Olaf,
**I want** a well-organized monorepo with clear structure and documentation,
**so that** I can clone the project, understand the layout, and start contributing immediately.

## Acceptance Criteria

1. Repository created on GitHub with name `olaf` under appropriate account
2. Directory structure matches architecture specification:
   ```
   olaf/
   ├── docs/                       # PRD, architecture, epics
   │   ├── prd.md
   │   ├── architecture.md
   │   ├── brief.md
   │   └── epics/
   ├── hardware/                   # 3D models, wiring, BOM
   │   ├── 3d-models/
   │   ├── wiring/
   │   └── bom/
   ├── modules/                    # ESP32 firmware (C++)
   │   ├── head/                   # I2C 0x08
   │   │   └── firmware/
   │   ├── ears-neck/              # I2C 0x09 (combined module)
   │   │   └── firmware/
   │   ├── body/                   # I2C 0x0A (heart LCD, projector, LEDs)
   │   │   └── firmware/
   │   └── base/                   # I2C 0x0B
   │       └── firmware/
   ├── orchestrator/               # Raspberry Pi Python + ROS2
   │   ├── ros2_nodes/
   │   │   └── hardware_drivers/
   │   ├── launch/
   │   └── config/
   ├── shared/                     # Common headers/definitions
   │   └── i2c_registers.h         # Shared I2C register map
   ├── tests/
   ├── tools/
   │   ├── setup/
   │   └── diagnostics/
   ├── config/
   │   └── api-keys.template.env
   ├── .gitignore
   ├── README.md
   └── LICENSE
   ```
3. README.md contains (from updated README):
   - Project overview (self-balancing AI companion)
   - Architecture diagram showing I2C-based communication
   - Quick start instructions
   - Links to PRD, architecture docs, epics
4. `.gitignore` configured to exclude:
   - Python: `__pycache__/`, `*.pyc`, `venv/`
   - ROS2: `build/`, `install/`, `log/`
   - PlatformIO: `.pio/`, `.vscode/`
   - Environment: `.env`
5. `shared/i2c_registers.h` created with common register definitions:
   ```cpp
   // Common registers (all modules)
   #define REG_MODULE_ID           0x00
   #define REG_FIRMWARE_VERSION    0x01
   #define REG_STATUS              0x02
   #define REG_COMMAND             0x04

   // Status flags
   #define STATUS_READY            0x01
   #define STATUS_BUSY             0x02
   #define STATUS_ERROR            0x04
   ```
6. `config/api-keys.template.env` created with placeholder for Claude API (future use)
7. MIT License file added
8. Initial commit pushed: "Initial repository structure with I2C architecture foundation"

## Tasks / Subtasks

### Task 1: Create repository structure (AC: 1, 2)
- [x] Create GitHub repository named `olaf`
- [x] Clone repository locally
- [x] Create all top-level directories per source tree specification
- [x] Create subdirectories for each module (head, ears-neck, body, base)
- [x] Create orchestrator subdirectories (ros2_nodes/hardware_drivers, launch, config)
- [x] Create hardware subdirectories (3d-models, wiring, bom)
- [x] Create tools subdirectories (setup, diagnostics)
- [x] Create tests directory
- [x] Verify structure matches AC #2 exactly

### Task 2: Create shared I2C register header (AC: 5)
- [x] Create `shared/` directory
- [x] Create `shared/i2c_registers.h` with common register definitions
- [x] Add header guards (`#pragma once`)
- [x] Define REG_MODULE_ID (0x00), REG_FIRMWARE_VERSION (0x01), REG_STATUS (0x02), REG_COMMAND (0x04)
- [x] Define STATUS_READY (0x01), STATUS_BUSY (0x02), STATUS_ERROR (0x04)
- [x] Add comments explaining register purpose and usage
- [x] Follow C++ coding standards for constants (UPPER_SNAKE_CASE for macros)

### Task 3: Create configuration files (AC: 4, 6)
- [x] Create `.gitignore` with patterns for Python, ROS2, PlatformIO, and environment files
- [x] Create `config/` directory
- [x] Create `config/api-keys.template.env` with placeholders for ANTHROPIC_API_KEY, ROS_DOMAIN_ID
- [x] Add comments explaining each environment variable's purpose
- [x] Ensure `.env` is in `.gitignore` (actual keys never committed)

### Task 4: Create README.md (AC: 3)
- [x] Create README.md at repository root
- [x] Add project title and tagline (self-balancing AI companion)
- [x] Add project overview explaining OLAF's purpose and features
- [x] Include architecture diagram showing I2C-based communication (or placeholder for diagram)
- [x] Add Quick Start section with setup instructions
- [x] Add links to documentation (PRD, architecture, epics)
- [x] Add links to key directories (modules, orchestrator, hardware)
- [x] Follow markdown conventions from coding standards

### Task 5: Add MIT License (AC: 7)
- [x] Create LICENSE file at repository root
- [x] Add MIT License text
- [x] Update copyright year and author name

### Task 6: Initial commit and push (AC: 8)
- [x] Stage all files: `.gitignore`, `README.md`, `LICENSE`, `shared/i2c_registers.h`, `config/api-keys.template.env`
- [x] Create commit with message: "Initial repository structure with I2C architecture foundation"
- [x] Follow conventional commits format (feat/fix/docs/etc)
- [x] Push to GitHub main branch

## Dev Notes

### Repository Organization Strategy

This story establishes OLAF's **monorepo** structure, which houses all firmware, orchestrator code, hardware designs, documentation, and tooling in a single repository.

**Key Principles:**
- **MECE Organization:** Each directory owns its domain exclusively (no overlap)
- **Educational Clarity:** Complete project structure visible in one clone
- **Coordinated Versioning:** Hardware, firmware, software evolve together
- **Build-in-Public Goal:** Community can replicate entire system from one repo

[Source: docs/architecture/source-tree.md#monorepo-benefits-for-olaf]

### Project Structure Specifications

The directory structure in AC #2 matches the official source tree specification exactly. All directories must be created as specified.

**Critical Directories:**
- `modules/` - ESP32 firmware (C++) for each hardware module (head 0x08, ears-neck 0x09, body 0x0A, base 0x0B)
- `orchestrator/` - Raspberry Pi software (Python/ROS2)
- `shared/` - Common headers/definitions (I2C register maps)
- `hardware/` - Physical design files (3D models, wiring, BOMs)
- `docs/` - All project documentation (PRD, architecture, epics)
- `tests/` - Unit, integration, hardware validation tests
- `tools/` - Setup scripts, calibration, diagnostics

[Source: docs/architecture/source-tree.md#top-level-directory-tree]

### I2C Register Map Foundation

The `shared/i2c_registers.h` file establishes the **common register protocol** that all ESP32 modules will implement. This is the foundation of the I2C-based communication architecture.

**Common Registers (All Modules):**
- `REG_MODULE_ID (0x00)` - Returns module identifier (0x08=Head, 0x09=Ears+Neck, 0x0A=Body, 0x0B=Base)
- `REG_FIRMWARE_VERSION (0x01)` - Firmware version for OTA tracking
- `REG_STATUS (0x02)` - Module status byte (READY/BUSY/ERROR flags)
- `REG_COMMAND (0x04)` - Command register for high-level operations

**Status Flags:**
- `STATUS_READY (0x01)` - Module ready to receive commands
- `STATUS_BUSY (0x02)` - Module processing command/animation
- `STATUS_ERROR (0x04)` - Error condition (check module logs)

**Architecture Context:**
- Each ESP32 module acts as an **I2C slave** with a unique address:
  - 0x08: Head (eyes, sensors, audio)
  - 0x09: Ears + Neck (7 servos via 2 UART controllers)
  - 0x0A: Body (heart LCD, projector relay, LEDs)
  - 0x0B: Base (balancing, odometry, kickstand)
- Raspberry Pi acts as **I2C master** coordinating all modules
- Shared register protocol enables consistent communication across all modules
- Module-specific registers (e.g., eye expression, servo angles) defined per module

[Source: docs/prd/epic-01-foundation.md#story-11-acceptance-criteria-5]

### File Naming Conventions

**From Coding Standards:**
- **Documentation:** `kebab-case.md` (e.g., `coding-standards.md`)
- **Python:** `snake_case.py` (e.g., `head_driver_node.py`)
- **C++ headers:** `snake_case.h` (e.g., `i2c_registers.h`)
- **Configuration:** `kebab-case.yaml` or `.env` format
- **3D models:** `<module>-<part>-v<version>.stl`

[Source: docs/architecture/coding-standards.md#file-naming-conventions]

### Version Control Standards

**Commit Messages:**
Follow Conventional Commits format:
- `feat:` for new features
- `fix:` for bug fixes
- `docs:` for documentation changes
- `refactor:` for code restructuring
- Example: `feat: add Whisper STT integration with Hailo accelerator`

**Initial Commit Message:**
Use exact message from AC #8: "Initial repository structure with I2C architecture foundation"

**Branch Strategy:**
- `main` - Stable releases only, always deployable
- `develop` - Integration branch (future use)
- Feature branches: `feature/<module>-<description>`

[Source: docs/architecture/coding-standards.md#version-control]

### Security and Safety

**API Key Management:**
- NEVER commit `.env` files with actual API keys
- ALWAYS provide `.template.env` with placeholder values
- Include `.env` in `.gitignore`
- Template shows required environment variables without exposing secrets

**Environment Variables for Template:**
```bash
# config/api-keys.template.env
# Copy to .env and fill in actual values

# Anthropic Claude API
ANTHROPIC_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxx

# ROS2 Domain ID (0-101, isolates from other ROS2 systems)
ROS_DOMAIN_ID=42
```

[Source: docs/architecture/coding-standards.md#security-and-safety]

### Git Ignore Patterns

**Required Exclusions:**
- **Python:** `__pycache__/`, `*.pyc`, `venv/`, `*.egg-info/`
- **ROS2:** `build/`, `install/`, `log/`
- **PlatformIO:** `.pio/`, `.vscode/`, `*.bin`
- **Environment:** `.env` (secrets)
- **IDE:** `.vscode/`, `.idea/` (personal preference)
- **Logs:** `*.log`

**Template files ARE committed:**
- `api-keys.template.env`

[Source: docs/architecture/source-tree.md#gitignore-highlights]

### Technology Stack Reference

**Version Control:** Git 2.40+
**License:** MIT open-source license (permissive)
**Repository Host:** GitHub (free for public repos, CI/CD via GitHub Actions)

[Source: docs/architecture/tech-stack.md#technology-stack-table]

### README Content Guidelines

The README should serve as the **entry point** for new contributors and hardware builders.

**Required Sections:**
1. **Project Overview:** Self-balancing AI companion robot
2. **Architecture Diagram:** I2C-based communication (Pi ↔ ESP32 modules)
3. **Quick Start:** Clone, setup, build instructions
4. **Documentation Links:** PRD, architecture, epics
5. **Directory Guide:** Brief explanation of top-level directories

**Tone:** Educational, welcoming, build-in-public friendly

[Source: docs/architecture/source-tree.md#for-new-contributors]

### Project Structure Notes

The structure in AC #2 perfectly aligns with the official source tree specification. No conflicts or deviations detected.

**Verification:**
- All directories in AC #2 match `docs/architecture/source-tree.md`
- Subdirectory structure for modules, orchestrator, hardware matches specification
- No additional directories required at this stage

## Testing

### Testing Standards

**Framework:** Manual verification (no automated tests for repository setup)

**Validation Steps:**
1. **Directory Structure:** Verify all directories created as specified
   - Use `tree` command or `ls -R` to validate structure
   - Compare output to AC #2 specification
2. **File Content:** Verify required files exist and contain correct content
   - Check `shared/i2c_registers.h` has correct register definitions
   - Check `.gitignore` excludes correct patterns
   - Check `config/api-keys.template.env` has correct placeholders
3. **README Quality:** Review README for completeness
   - Ensure all required sections present (overview, quick start, links)
   - Verify links point to correct documentation files
4. **License:** Confirm MIT License text is correct
5. **Commit:** Verify commit message matches AC #8 exactly
6. **GitHub:** Confirm repository exists and is accessible

**Test Location:** Manual validation (no test files for this story)

**Success Criteria:**
- All AC items verifiable via file system inspection
- Repository successfully pushed to GitHub
- Structure matches specification exactly

[Source: docs/architecture/coding-standards.md#testing-standards]

## Change Log

| Date       | Version | Description                          | Author          |
|------------|---------|--------------------------------------|-----------------|
| 2025-10-12 | v1.0    | Initial story draft created          | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References

No blocking issues encountered. All tasks completed successfully.

### Completion Notes

**Implementation Summary:**

All acceptance criteria met successfully:

1. ✅ Repository structure created with all required directories
2. ✅ shared/i2c_registers.h implemented with comprehensive I2C protocol definitions
3. ✅ .gitignore updated with all required exclusions (Python, ROS2, PlatformIO, environment)
4. ✅ config/api-keys.template.env created with secure placeholder format
5. ✅ README.md updated with corrected documentation links to sharded structure
6. ✅ MIT License already present and correct
7. ✅ Changes committed and pushed to GitHub

**Key Implementation Details:**

- Created firmware/ subdirectories under all module directories (head, ears-neck, body, base)
- Created orchestrator/ros2_nodes/hardware_drivers/ structure
- Created tools/setup/ and tools/diagnostics/ subdirectories
- shared/i2c_registers.h includes extensive comments with usage examples for both Python (orchestrator) and C++ (ESP32) sides
- config/api-keys.template.env includes all required environment variables with detailed comments
- Updated README.md documentation links from old flat structure to new sharded structure (docs/prd/index.md, docs/architecture/index.md)

**Architecture Notes:**

The I2C register map in shared/i2c_registers.h establishes the foundation for the distributed architecture where:
- Raspberry Pi acts as I2C master coordinating all 4 modules
- Each ESP32 module acts as intelligent I2C slave:
  - 0x08: Head (eyes, sensors, audio)
  - 0x09: Ears + Neck (7 servos via 2 UART controllers)
  - 0x0A: Body (heart LCD, projector relay, LEDs)
  - 0x0B: Base (balancing, odometry, kickstand)
- Common registers (MODULE_ID, FIRMWARE_VERSION, STATUS, COMMAND) provide consistent interface across all modules

### File List

**New Files Created:**
- shared/i2c_registers.h
- config/api-keys.template.env

**Modified Files:**
- .gitignore (added Python, ROS2, PlatformIO, environment exclusions)
- README.md (updated documentation links to sharded structure)

**New Directories Created:**
- shared/
- config/
- modules/head/firmware/
- modules/ears-neck/firmware/
- modules/body/firmware/
- modules/base/firmware/
- orchestrator/ros2_nodes/
- orchestrator/ros2_nodes/hardware_drivers/
- orchestrator/launch/
- orchestrator/config/
- tools/setup/
- tools/diagnostics/

## QA Results

### Review Date: 2025-10-12

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall Rating: EXCELLENT**

This story represents foundational infrastructure setup with exemplary execution:

✅ **Comprehensive I2C Protocol Design**: The `shared/i2c_registers.h` file goes beyond minimal requirements with extensive documentation, usage examples for both Python and C++, and clear architectural context. This establishes a solid foundation for the distributed ESP32 architecture.

✅ **Security Best Practices**: Proper separation of template and actual secrets (.env in .gitignore, template with placeholders). The api-keys.template.env includes clear instructions and covers both immediate needs (Claude API) and future requirements (OpenAI fallback, hardware config).

✅ **Documentation Quality**: README.md correctly updated to reflect sharded documentation structure. Links point to proper index files (docs/prd/index.md, docs/architecture/index.md) rather than non-existent flat files.

✅ **Directory Structure**: All required directories created per specification, including firmware subdirectories that weren't explicitly called out but are architecturally necessary.

### Refactoring Performed

No refactoring required. Implementation follows coding standards and architectural specifications precisely.

### Compliance Check

- **Coding Standards**: ✅ PASS
  - File naming follows conventions (`i2c_registers.h`, `api-keys.template.env`)
  - C++ header uses `#pragma once` (modern standard)
  - Constants use `UPPER_SNAKE_CASE` for macros as specified
  - Comments explain WHY not just WHAT (excellent documentation)

- **Project Structure**: ✅ PASS
  - All directories match source-tree.md specification
  - Additional firmware/ subdirectories show proactive architectural thinking
  - Separation of concerns maintained (shared/, config/, modules/, orchestrator/)

- **Testing Strategy**: ✅ PASS (N/A for infrastructure)
  - Manual validation approach is appropriate for repository setup
  - Clear validation steps documented in story Testing section
  - Verification performed via file system inspection and git log

- **All ACs Met**: ✅ PASS
  - AC1: Repository exists on GitHub ✅
  - AC2: Directory structure matches specification ✅
  - AC3: README.md contains all required sections with correct links ✅
  - AC4: .gitignore properly configured ✅
  - AC5: shared/i2c_registers.h with comprehensive definitions ✅
  - AC6: config/api-keys.template.env with proper placeholders ✅
  - AC7: MIT License present ✅
  - AC8: Commit follows conventional commits format ✅

### Requirements Traceability

**Given** a developer wants to contribute to OLAF
**When** they clone the repository
**Then** they see a well-organized monorepo with clear structure

✅ **Validation**: Directory structure verified, all paths exist, organization is MECE (Mutually Exclusive, Collectively Exhaustive)

**Given** modules need to communicate via I2C
**When** developers implement firmware or orchestrator code
**Then** they have a shared register protocol to follow

✅ **Validation**: `shared/i2c_registers.h` provides common protocol with excellent documentation and usage examples

**Given** developers need to configure API keys
**When** they review the template
**Then** they understand what keys are needed and how to configure them

✅ **Validation**: `config/api-keys.template.env` includes clear instructions, placeholder format, and security warnings

### Security Review

**Status: PASS**

✅ **Secrets Management**: `.env` properly excluded from version control, template committed with placeholders only

✅ **Documentation**: Clear warnings about never committing actual .env files

✅ **Access Control**: No hardcoded credentials or API keys in any committed files

### Performance Considerations

**Status: N/A for repository setup**

Future consideration: The I2C protocol targets <100ms latency per operation. Future stories implementing I2C communication should validate against this target.

### Non-Functional Requirements Assessment

**Maintainability**: ✅ EXCELLENT
- Self-documenting file structure
- Comprehensive inline comments explaining architectural decisions
- Usage examples in header files accelerate future development

**Reliability**: ✅ EXCELLENT
- Clear separation of concerns reduces coupling
- Template-based configuration prevents secret exposure
- Defensive .gitignore prevents accidental commits of artifacts

**Scalability**: ✅ EXCELLENT
- Monorepo structure supports coordinated versioning
- Module-based organization allows independent development
- Clear interfaces (I2C register protocol) enable distributed work

### Test Architecture Assessment

**Manual Validation Approach**: ✅ APPROPRIATE

For repository setup, manual validation is the correct approach:
- Directory existence can be verified via `ls` or `find`
- File content verified via inspection
- Git history confirms proper commits
- No runtime behavior to test

**Validation Coverage**: ✅ COMPREHENSIVE
- All 8 acceptance criteria have clear validation steps
- File content verification documented
- Git commit format verified

### Technical Debt Identification

**None identified.** This is a clean foundation with no shortcuts or workarounds.

**Future Considerations** (not debt, just notes for next stories):
1. Consider adding `.editorconfig` for IDE consistency (future enhancement)
2. Consider adding `.gitattributes` for line ending consistency (future enhancement)
3. Future stories will need README placeholders (e.g., CONTRIBUTING.md mentioned but not created)

### Files Modified During Review

None. No refactoring or corrections needed.

### Gate Status

**Gate: PASS** → docs/qa/gates/1.1-repository-setup.yml

**Quality Score: 100/100**

**Risk Profile**: LOW
- No code execution risk (infrastructure only)
- No security vulnerabilities
- No performance concerns
- High maintainability

**Requirements Coverage**: 8/8 Acceptance Criteria Met

### Recommended Status

✅ **Ready for Done**

This story exemplifies high-quality implementation:
- All acceptance criteria met
- Excellent documentation and architectural thinking
- Security best practices followed
- Clear foundation for future development
- No technical debt introduced

**Recommendation**: Mark as Done and proceed to next story (1.2 Power System).
