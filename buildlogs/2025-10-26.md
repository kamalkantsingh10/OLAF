# Build Log - October 26, 2025
## OLAF's Eyes: The Great ESP32-S3 Display Debug

**Story 1.3 - Task 5: Test SPI Displays**

---

## The Challenge

Two GC9A01 round displays (240×240 pixels) needed to become OLAF's eyes. After previous failed attempts, we started fresh with the TFT_eSPI library. Hardware setup: ESP32-S3 driving dual displays over SPI at 20MHz.

**Pin Configuration:**
- Shared: MOSI=GPIO11, SCK=GPIO12, DC=GPIO2, RST=GPIO4, BL=GPIO10
- Left Eye CS: GPIO5
- Right Eye CS: GPIO15

## The Three-Bug Journey

### Bug #1: The Breadboard
First upload → immediate crash with Guru Meditation error (StoreProhibited). Minimal GPIO test worked fine. Backlight toggle test worked. The ESP32-S3 wasn't fully seated in the breadboard. Pushed it down properly.

Still crashed. Not the root cause.

### Bug #2: Duplicate Pin Definitions
Inspection of `.pio/libdeps/.../TFT_eSPI/User_Setup.h` revealed duplicate pin definitions — ESP8266 pins (PIN_D7, PIN_D5) defined before ESP32-S3 pins. The preprocessor used the first definitions it found, pointing to non-existent pins.

Fixed by commenting out lines 170-176 (ESP8266 section).

Still crashed. Not the full solution.

### Bug #3: Platform Bug
Web search for "ESP32-S3 TFT_eSPI GC9A01 crash StoreProhibited" revealed multiple GitHub issues. Pattern: espressif32 platform >= 6.7.0 breaks TFT_eSPI on ESP32-S3 and ESP32-C3.

**Solution:** `#define USE_HSPI_PORT`

One line. Hours of debugging.

## Victory

After enabling `USE_HSPI_PORT`, the displays initialized successfully:

```
✓ TFT initialized
TEST 1: Fill RED
TEST 2: Fill GREEN
TEST 3: Fill BLUE
TEST 4: Draw concentric circles
TEST 5: Draw text "OLAF"
Entering animation loop...
FPS: 2.0
```

Both displays work. Test patterns render correctly: solid colors, circles, text. Animation loop cycles through colors smoothly.

## Technical Configuration

**`.pio/libdeps/esp32-s3-devkitc-1/TFT_eSPI/User_Setup.h`:**
```cpp
#define GC9A01_DRIVER
#define TFT_WIDTH  240
#define TFT_HEIGHT 240
#define TFT_MOSI 11
#define TFT_SCLK 12
#define TFT_CS   5
#define TFT_DC   2
#define TFT_RST  4
#define TFT_BL   10
#define SPI_FREQUENCY 20000000
#define USE_HSPI_PORT  // Critical fix for ESP32-S3
```

**`platformio.ini`:**
```ini
[env:esp32-s3-devkitc-1]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
lib_deps = bodmer/TFT_eSPI@^2.5.43
```

## Known Limitations

Independent CS control not yet working — both displays currently mirror same content. TFT_eSPI's single TFT object and hardware SPI CS control prevents manual GPIO control of chip select pins. Future work will require different architecture (dual TFT objects, custom SPI management, or alternative library).

## Key Learnings

1. **Platform bugs are sneaky** - espressif32 v6.12.0 silently broke SPI on ESP32-S3
2. **Multiple bugs compound** - Three separate issues masked each other
3. **Community wisdom saves time** - GitHub issues provided the critical clue
4. **Incremental debugging works** - Minimal tests → add complexity → isolate variables
5. **Preprocessor order matters** - First `#define` wins

## Status

**Task 5: Partially Complete**
- ✅ TFT_eSPI library configured
- ✅ Both displays initialize and work
- ✅ SPI communication stable at 20MHz
- ✅ Test patterns render correctly
- ⏳ Independent CS control (deferred)

**Next Steps:**
- Task 6: Test I2C connection to Raspberry Pi
- Task 7: Physical mounting
- Task 8: Documentation

---

**Contributors:** James (Dev Agent), Kamal (Builder)
**Session Duration:** ~4 hours
**Final Result:** Displays functional, ready for animation development
**Lesson:** Sometimes the bug isn't in your code — it's in the platform.
