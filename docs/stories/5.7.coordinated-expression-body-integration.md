# Story 5.7: Coordinated Expression Enhancement - Body Integration

## Status
Draft

## Story
**As a** software developer,
**I want** Epic 3 coordinated expression system enhanced with body (heart display) integration,
**so that** Olaf displays coherent emotions across eyes, ears, neck, AND body.

## Acceptance Criteria

1. **Existing System Base:**
   - Start from Epic 3 `coordinated_expression.py`
   - Existing: Eyes (0x08), Ears+Neck (0x09) coordination working
   - 7 emotions already defined (neutral, happy, curious, thinking, confused, sad, excited)

2. **Body Expression Mapping:**
   - Enhance emotion definitions to include heart animation parameters:
   - **Neutral:**
     - Heart: Mode 1 (idle pulse), 60 BPM, red (#FF0000), brightness 128
   - **Happy:**
     - Heart: Mode 2 (excited), 90 BPM, bright red (#FF3030), brightness 255
   - **Curious:**
     - Heart: Mode 1 (idle pulse), 75 BPM, orange (#FF8800), brightness 200
   - **Thinking:**
     - Heart: Mode 3 (slow), 50 BPM, blue-tinted (#8800FF), brightness 180
   - **Confused:**
     - Heart: Mode 1 (idle pulse), 65 BPM, purple (#CC00CC), brightness 150
   - **Sad:**
     - Heart: Mode 3 (slow), 45 BPM, dark blue (#0044AA), brightness 100
   - **Excited:**
     - Heart: Mode 2 (excited), 120 BPM, yellow-red (#FFAA00), brightness 255

3. **Multi-Modal Coordination Logic Enhancement:**
   - For each emotion, compute and publish:
     - Eye expression → `/olaf/head/expression` (Epic 1)
     - Ear positions → `/olaf/ears/position` (Epic 3)
     - Neck position → `/olaf/neck/position` (Epic 3)
     - **NEW: Heart animation** → `/olaf/body/heart_animation` (Epic 5)
   - All four modality commands published simultaneously (atomic emotion change)

4. **Testing:**
   - **Emotion Tests (all 7 emotions):**
     - Publish "happy": Eyes brighten, ears up, head tilts, **heart beats fast in bright red**
     - Publish "sad": Eyes droop, ears down, head lowers, **heart beats slow in dark blue**
     - Publish "curious": Eyes widen, ears forward, head rolls, **heart beats medium in orange**
     - Verify visual coherence: Heart color matches emotional tone
   - **Multi-Modal Sync:**
     - Verify all four modalities change simultaneously (<50ms variance)
     - 50 emotion cycles without desynchronization

5. **Code Quality:**
   - File: `coordinated_expression.py` updated
   - Emotion mapping config: YAML or Python dict with heart parameters
   - Comments explain color psychology, BPM-emotion mapping
   - Code committed to `ros2/src/orchestrator/ros2_nodes/`

## Dependencies
- Story 5.6: Body driver
- Epic 3 Story 3.9: Coordinated expression base

## Estimated Effort
4-6 hours

## Dev Agent Record

### Agent Model Used
<!-- To be filled by dev agent -->

### Debug Log References
<!-- To be filled by dev agent -->

### Completion Notes List
<!-- To be filled by dev agent -->

### File List
<!-- To be filled by dev agent -->

## QA Results
<!-- To be filled by QA agent -->

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-11-30 | v1.0 | Initial story creation from Epic 5 | John (Product Manager) |
